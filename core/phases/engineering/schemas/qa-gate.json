{
  "template": {
    "id": "qa-gate-template-v1",
    "name": "Quality Gate Decision",
    "version": "1.0",
    "output": {
      "format": "json",
      "filename": "docs/qa/gates/{{epic_num}}.{{story_num}}-{{story_slug}}.json",
      "title": "Quality Gate: {{epic_num}}.{{story_num}}"
    }
  },
  "required_fields": {
    "comment": "Keep these first",
    "schema": 1,
    "story": "{{epic_num}}.{{story_num}}",
    "story_title": "{{story_title}}",
    "gate": "{{gate_status}}",
    "gate_comment": "PASS|CONCERNS|FAIL|WAIVED",
    "status_reason": "{{status_reason}}",
    "status_reason_comment": "1-2 sentence summary of why this gate decision",
    "reviewer": "Quinn (Test Architect)",
    "updated": "{{iso_timestamp}}"
  },
  "default_fields": {
    "waiver": {
      "comment": "Always present but only active when WAIVED",
      "active": false
    },
    "top_issues": {
      "comment": "Issues (if any) - Use fixed severity: low | medium | high",
      "value": []
    },
    "risk_summary": {
      "comment": "Risk summary (from risk-profile task if run)",
      "totals": {
        "critical": 0,
        "high": 0,
        "medium": 0,
        "low": 0
      },
      "recommendations": {
        "must_fix": [],
        "monitor": []
      }
    }
  },
  "examples": {
    "with_issues": {
      "comment": "Example with issues found",
      "top_issues": [
        {
          "id": "SEC-001",
          "severity": "high",
          "severity_comment": "ONLY: low|medium|high",
          "finding": "No rate limiting on login endpoint",
          "suggested_action": "Add rate limiting middleware before production"
        },
        {
          "id": "TEST-001",
          "severity": "medium",
          "finding": "Missing integration tests for auth flow",
          "suggested_action": "Add test coverage for critical paths"
        }
      ]
    },
    "when_waived": {
      "comment": "Example when gate is waived",
      "waiver": {
        "active": true,
        "reason": "Accepted for MVP release - will address in next sprint",
        "approved_by": "Product Owner"
      }
    }
  },
  "optional_fields_examples": {
    "comment": "Uncomment and use if your team wants more detail",
    "quality_and_expiry": {
      "quality_score": 75,
      "quality_score_comment": "0-100 (optional scoring)",
      "expires": "2025-01-26T00:00:00Z",
      "expires_comment": "Optional gate freshness window"
    },
    "evidence": {
      "tests_reviewed": 15,
      "risks_identified": 3,
      "trace": {
        "ac_covered": [1, 2, 3],
        "ac_covered_comment": "AC numbers with test coverage",
        "ac_gaps": [4],
        "ac_gaps_comment": "AC numbers lacking coverage"
      }
    },
    "nfr_validation": {
      "security": {
        "status": "CONCERNS",
        "notes": "Rate limiting missing"
      },
      "performance": {
        "status": "PASS",
        "notes": "Code-level performance analysis only - excludes benchmark metrics"
      },
      "reliability": {
        "status": "PASS",
        "notes": ""
      },
      "maintainability": {
        "status": "PASS",
        "notes": ""
      }
    },
    "history": {
      "comment": "Append-only audit trail",
      "entries": [
        {
          "at": "2025-01-12T10:00:00Z",
          "gate": "FAIL",
          "note": "Initial review - missing tests"
        },
        {
          "at": "2025-01-12T15:00:00Z",
          "gate": "CONCERNS",
          "note": "Tests added but rate limiting still missing"
        }
      ]
    },
    "risk_summary_detailed": {
      "comment": "From risk-profile task",
      "totals": {
        "critical": 0,
        "high": 0,
        "medium": 0,
        "low": 0
      },
      "highest_comment": "emitted only when risks exist",
      "recommendations": {
        "must_fix": [],
        "monitor": []
      }
    },
    "recommendations": {
      "immediate": {
        "comment": "Must fix before production",
        "items": [
          {
            "action": "Add rate limiting to auth endpoints",
            "refs": ["api/auth/login.ts:42-68"]
          }
        ]
      },
      "future": {
        "comment": "Can be addressed later",
        "items": [
          {
            "action": "Consider caching for better performance",
            "refs": ["services/data.service.ts"]
          }
        ]
      }
    }
  }
}
