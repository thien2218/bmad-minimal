$schema: ../../.internal/task.schema.json
id: create-standalone-story
title: Create Standalone Story
purpose: Create a single user story for very small standalone enhancements that can be completed in one focused development session while following existing system patterns.
category: planning
agent: pdm

derived:
  - name: enhancement_description
    type: string
    source: parameters
    description: "User-supplied description of the standalone enhancement (${description})."
    required: true
  - name: story_enhancement_number_resolved
    type: number
    source: context
    description: "Identifier used in story filename (uses ${story_enhancement_number} when provided, otherwise auto-increments)."
    required: true
  - name: story_file_target
    type: path
    source: context
    pattern: "@{docs.subdirs.stories}/standln-{story_enhancement_number_resolved}-*.yaml"
    required: true
  - name: impact_assessment
    type: string
    source: context
    pattern: "^[1-4]$"
    description: "Response collected during Assess Document Impact (1-4)."

outputs:
  artifacts:
    - name: Standalone Story
      type: file
      path: "!{story_file_target}"
      format: yaml
    - name: Documentation Updates
      type: file
      path: "@{docs.dir}/"
      format: markdown

prerequisites:
  - field: "@{docs.subdirs.stories}"
    value: "writable"
    operator: "="
    on_violate: "halt_and_report"

steps:
  - id: ASSESS-SCOPE
    title: Assess if standalone story is appropriate
    description: Confirm the enhancement meets the criteria for a standalone story
    action:
      type: elicit
      prompt_user: |
        Before creating a standalone story, confirm this enhancement meets ALL criteria:

        Use standalone story when:
        - Enhancement can be completed in a single story
        - No new architecture or significant design is required
        - Change follows existing patterns exactly
        - Integration is straightforward with minimal risk
        - Change is isolated with clear boundaries

        Use create-epic when:
        - Enhancement requires 2–3 coordinated stories
        - Some design work is needed
        - Multiple integration points are involved

        Use full PRD/Architecture process when:
        - Enhancement requires multiple coordinated stories
        - Architectural planning is needed
        - Significant integration work is required

        Does this enhancement meet standalone story criteria?
        1 = Yes
        2 = No, escalate to epic
        3 = No, escalate to PRD
      options: ["1", "2", "3"]

  - id: GATHER-CONTEXT
    title: Gather minimal project context
    description: Collect essential context about the existing system and change scope
    action:
      type: analysis
      instruction: |
        Capture:
        **Current System Context**
        - Relevant existing functionality
        - Technology stack for this area
        - Integration points that must remain intact
        - Existing patterns to follow

        **Change Scope**
        - Specific change definition
        - Impact boundaries
        - Success criteria

  - id: SANITY-CHECK
    title: Validate standalone change understanding with user
    description: Ensure the interpreted enhancement description matches user intent before writing the story
    action:
      type: elicit
      prompt_user: |
        Provide a concise summary covering the standalone change goal, scope boundaries, dependencies, and any open questions.
        Confirm whether this summary aligns with the original change description:
        1) Yes, it is accurate — continue
        2) No, corrections are needed — describe adjustments
      options: ["1", "2"]

  - id: CREATE-STORY-FILE
    title: Create standalone story YAML file
    description: Create the story using the canonical story schema
    action:
      type: file_operation
      operation: create
      target: "!{story_file_target}"
      schema: "core/engineering/schemas/story.json"

  - id: ASSESS-DOCUMENT-IMPACT
    title: Assess impact on PRD and architecture documents
    description: Determine if documentation updates are needed for this standalone story
    action:
      type: elicit
      prompt_user: |
        Evaluate whether this story impacts PRD and/or architecture documents:
        1. No impact
        2. PRD impact only
        3. Architecture impact only
        4. Both PRD and Architecture impact

        Select the impact assessment (1-4).
      options: ["1", "2", "3", "4"]

  - id: UPDATE-DOCUMENTS
    title: Update affected documentation if needed
    description: Apply PRD/architecture updates when the impact assessment requires it
    action:
      type: analysis
      instruction: |
        If !{impact_assessment} == "1": document "No documentation updates required."
        Otherwise:
        - Update PRD sections for scope/requirement changes
        - Update architecture docs for component/data/API changes
        - Summarize updates in the story dev notes

  - id: VALIDATE-COMPLETION
    title: Validate story creation completion
    description: Confirm all success criteria are met for the standalone story
    action:
      type: validation
      instruction: |
        Confirm:
        - Enhancement is clearly defined and scoped for a single session
        - Integration approach is straightforward and low-risk
        - Existing patterns are identified and followed
        - Rollback plan is simple and feasible
        - Acceptance criteria include existing functionality verification
        - Story file created at @{docs.subdirs.stories}/standln-{{story_enhancement_number_resolved}}-*.yaml
        - Documentation updates recorded or explicitly not required

  - id: HANDOFF-STANDALONE
    title: Provide Story Summary
    description: Communicate story creation outcome and next steps
    action:
      type: hand_off
      prompt_user: |
        Story created: !{story_file_target}

        Summary of key details:
        - Enhancement goal and scope boundaries are documented
        - Pattern alignment and integration constraints captured
        - Documentation impact: !{impact_assessment}

        Next steps:
        - Review the story for completeness
        - Move to implementation or schedule validation as needed

completion:
  criteria:
    - Story enhancement meets standalone criteria
    - Story file created with proper schema structure
    - All required sections populated with elicited content
    - Documentation impact assessed and updated as needed
    - Completion validation executed successfully
