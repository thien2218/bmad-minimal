$schema: ../../.internal/task.schema.json
id: create-epic
title: Create Epic Task
version: 1.0.0
purpose: Create a single epic for an initiative listed in a PRD
category: planning
agent: pdm

inputs:
   required:
      - name: epic_number
        type: number
        description: Number to index the epic (derived by incrementing the highest number of the previously created highest order epic)
        examples: [1, 3, 4]
      - name: enhancement_name
        type: string
        description: Name of the enhancement
        examples:
           [
              "Add Export Feature",
              "Update Dashboard Analytics",
              "Enhance Search Functionality",
           ]
      - name: existing_system_context
        type: string
        description: Description of current relevant functionality
      - name: technology_stack
        type: string
        description: Relevant existing technologies in the system, derived from {@docs.files.codingStandards}
        examples:
           [
              "React, Node.js, PostgreSQL",
              "Vue, Django, MySQL",
              "Angular, .NET, SQL Server",
           ]
   optional:
      - name: integration_points
        type: array
        description: Where new work connects to existing system
        examples:
           [["API Gateway", "User Service"], ["Database Layer", "Cache Layer"]]
      - name: success_criteria
        type: array
        description: Measurable outcomes for the enhancement
      - name: primary_risk
        type: string
        description: Main risk to existing system
      - name: rollback_plan
        type: string
        description: How to undo changes if needed

outputs:
   artifacts:
      - name: epic_document
        type: file
        path: "{@docs.subdirs.epics}/{epic_number}-{enhancement_name}.yaml"
        format: yaml
        description: Brownfield epic document with all required sections in YAML

prerequisites:
   files:
      - "{@docs.subdirs.prds}/{prd_slug}.md"

process:
   mode: sequential
   steps:
      - id: ANALYZE-PROJECT
        title: Project Analysis
        description: Gather essential information about the existing project
        action:
           type: analysis
           prompt: |
              Before creating the epic, analyze:
              - PRD epic list and goals
              - Initiative scope and requirements
              - Architecture constraints and dependencies
              - Success criteria and acceptance thresholds

      - id: VALIDATE-SCOPE
        title: Validate Enhancement Scope
        description: Ensure the enhancement is appropriate for this task
        action:
           type: validation
           validation:
              type: string
              required: true
           prompt: |
              Validate that:
              - Epic is listed in the PRD epic list
              - Epic scope aligns with PRD goals
              - Epic can be completed in reasonable number of stories
              - Dependencies and constraints are understood

              If any of these are false, recommend reviewing the PRD first
        on_failure: halt

      - id: CREATE-EPIC-HEADER
        title: Create Epic File with Schema Structure
        description: Initialize epic YAML file following the epic schema structure
        action:
           type: file_operation
           operation: create
           target: "{@docs.subdirs.epics}/{epic_number}-{enhancement_name}.yaml"
           content: |
              status: Draft
              epic-overview:
                goal: "{1-2 sentences describing what the epic will accomplish and why it adds value}"
                description: ""
                definition_of_done: []
              scope-boundaries:
                in-scope: []
                out-of-scope: []
              requirements-mapping:
                functional-requirements: []
                non-functional-requirements: []
              story-breakdown:
                story-list: []
                story-sequencing-rationale: ""
              dependencies:
                dependencies: []
                story-dependencies: []

      - id: ADD-EPIC-DESCRIPTION
        title: Add Epic Description
        description: Update epic-overview section with detailed description
        action:
           type: file_operation
           operation: update
           target: "{@docs.subdirs.epics}/{epic_number}-{enhancement_name}.yaml"
           content: |
              epic-overview:
                description: |
                  Initiative: {enhancement_name}
                  
                  PRD Context:
                  {prd_context}
                  
                  Implementation approach: {clear description}
                  Success criteria: {measurable outcomes}

      - id: DEFINE-STORIES
        title: Define Stories
        description: List 1-3 focused stories that complete the epic
        action:
           type: elicit
           prompt: |
              Define focused stories with priorities (1-5, 1=highest):
              - Follow the story breakdown from the PRD
              - Sequence by dependencies first
              - Then by priority to deliver highest value
              - Each story should be completable in one sprint
           validation:
              type: array
              required: true
        elicit: true

      - id: ADD-STORIES
        title: Add Stories to Epic
        description: Update story-breakdown section with story list and sequencing
        action:
           type: file_operation
           operation: update
           target: "{@docs.subdirs.epics}/{epic_number}-{enhancement_name}.yaml"
           content: |
              story-breakdown:
                story-list:
                  - "1: **{Story 1 title}** - {Story 1 brief description} [Priority: {1-5}]"
                  - "2: **{Story 2 title}** - {Story 2 brief description} [Priority: {1-5}]"
                  - "3: **{Story 3 title}** - {Story 3 brief description} [Priority: {1-5}]"
                story-sequencing-rationale: |
                  Stories are sequenced by dependencies first, then by priority to deliver highest value.
                  Each story builds upon previous stories and is sized for AI agent execution (2-4 hours).

      - id: ADD-SCOPE-BOUNDARIES
        title: Add Scope and Boundaries
        description: Update scope-boundaries section with in-scope and out-of-scope items
        action:
           type: file_operation
           operation: update
           target: "{@docs.subdirs.epics}/{epic_number}-{enhancement_name}.yaml"
           content: |
              scope-boundaries:
                in-scope:
                  - "Initiative: {enhancement_name}"
                  - "Requirements from PRD epic definition"
                  - "Architecture constraints and dependencies"
                  - "Stories defined in epic breakdown"
                out-of-scope:
                  - "Other PRD epics and initiatives"
                  - "Requirements not in current PRD"
                  - "Cross-cutting concerns handled elsewhere"

      - id: ADD-DOD
        title: Add Definition of Done
        description: Update epic-overview definition_of_done per schema
        action:
           type: file_operation
           operation: update
           target: "{@docs.subdirs.epics}/{epic_number}-{enhancement_name}.yaml"
           content: |
              epic-overview:
                definition_of_done:
                  - "1: All stories completed with acceptance criteria met"
                  - "2: Epic goals from PRD achieved"
                  - "3: Integration points working correctly"
                  - "4: Documentation updated appropriately"
                  - "5: Quality gates passed"

      - id: VALIDATE-EPIC
        title: Validate Epic Completeness
        description: Ensure all required elements are present
        action:
           type: validation
           prompt: |
              Validate that the epic includes:
              - Clear goal and description aligned with PRD
              - Stories that support PRD epic objectives
              - Scope boundaries matching PRD definition
              - Definition of done
              - All stories follow PRD requirements

dependencies:
   checklists:
      - pd-master-checklist.yaml
   schemas:
      - epic.json

blocking_conditions:
   - condition: "Enhancement requires more than 3 stories"
     message: Scope too large for this task - use full PRD process
     severity: error
   - condition: "Significant architectural changes required"
     message: Architectural planning needed - use full process
     severity: error
   - condition: "High risk to existing system"
     message: Risk assessment needed - use full process
     severity: error

completion:
   criteria:
       - Epic scope aligns with PRD epic definition
       - Stories support PRD goals and requirements
       - Dependencies and constraints are understood
       - Stories are logically sequenced for implementation
       - Acceptance criteria are clearly defined
       - Epic delivers value per PRD objectives

metadata:
   author: Thien Huynh
   created: 2024-01-01
   lastModified: 2024-01-01
   tags:
      - epic
      - planning
      - prd
      - initiative
   complexity: moderate
   estimated_duration: 30m-1h
